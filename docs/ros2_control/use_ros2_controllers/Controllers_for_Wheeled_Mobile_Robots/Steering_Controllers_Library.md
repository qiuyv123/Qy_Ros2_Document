# Steering Controllers Libraryï¼ˆè½¬å‘æ§åˆ¶å™¨åº“ï¼‰

`steering_controllers_library` æ˜¯ä¸€ä¸ªé¢å‘**å¸¦è½¬å‘é©±åŠ¨çš„ç§»åŠ¨æœºå™¨äºº**ï¼ˆ2 è‡ªç”±åº¦ï¼‰çš„æ§åˆ¶å™¨åº“ï¼Œé€‚ç”¨äºå…·æœ‰**éå®Œæ•´çº¦æŸ**ï¼ˆnon-holonomic constraintsï¼‰çš„ç³»ç»Ÿã€‚

- å®ç°äº†**é€šç”¨çš„é‡Œç¨‹è®¡è®¡ç®—**ä¸**æ›´æ–°é€»è¾‘**
- å®šä¹‰äº†æ ‡å‡†æ¥å£
- **ä»…ä½¿ç”¨é€†è¿åŠ¨å­¦**ï¼ˆinverse kinematicsï¼‰ï¼Œ**ä¸åŒ…å«åé¦ˆæ§åˆ¶å›è·¯**ï¼ˆå¦‚è·¯å¾„è·Ÿè¸ªç­‰é«˜çº§æ§åˆ¶ï¼‰

> ğŸ“š æœ‰å…³ç§»åŠ¨æœºå™¨äººè¿åŠ¨å­¦åŸºç¡€åŠæœ¬æ–‡ä½¿ç”¨çš„æœ¯è¯­ï¼Œè¯·å‚é˜…ï¼š[è½®å¼ç§»åŠ¨æœºå™¨äººè¿åŠ¨å­¦ï¼ˆWheeled Mobile Robot Kinematicsï¼‰](./mobile_robot_kinematics.html)

---

## æ§åˆ¶å™¨æ‰§è¡Œé€»è¾‘

- **è¾“å…¥**ï¼šé€Ÿåº¦æŒ‡ä»¤ï¼ˆ`Twist` æˆ– `TwistStamped` æ¶ˆæ¯ï¼‰
  - ä»…ä½¿ç”¨ **çº¿é€Ÿåº¦ x åˆ†é‡** å’Œ **è§’é€Ÿåº¦ z åˆ†é‡**
  - å…¶ä»–åˆ†é‡è¢«å¿½ç•¥
- **é“¾å¼æ¨¡å¼**ï¼ˆchained modeï¼‰ä¸‹ï¼Œæä¾›ä¸¤ä¸ªå‚è€ƒæ¥å£ï¼š
  - çº¿é€Ÿåº¦å‚è€ƒ
  - è½¬å‘è§’ä½ç½®å‚è€ƒ
- **å…¶ä»–ç‰¹æ€§**ï¼š
  - æ”¯æŒ**å‰è½®è½¬å‘**å’Œ**åè½®è½¬å‘**é…ç½®
  - å‘å¸ƒ `Odometry` å’Œ `TF` æ¶ˆæ¯
  - åŸºäºå‚æ•°çš„**è¾“å…¥å‘½ä»¤è¶…æ—¶æœºåˆ¶**
- è½®å­å‘½ä»¤é€šè¿‡**é‡Œç¨‹è®¡åº“**è®¡ç®—ï¼Œæ ¹æ®å…·ä½“è¿åŠ¨å­¦æ¨¡å‹ç”Ÿæˆ**ç‰µå¼•**ï¼ˆtractionï¼‰å’Œ**è½¬å‘**ï¼ˆsteeringï¼‰æŒ‡ä»¤

---

## å½“å‰æ”¯æŒçš„è¿åŠ¨å­¦æ¨¡å‹

| æ¨¡å‹ | è½¬å‘å…³èŠ‚ | é©±åŠ¨å…³èŠ‚ |
|------|--------|--------|
| **Bicycle**ï¼ˆè‡ªè¡Œè½¦æ¨¡å‹ï¼‰ | 1 ä¸ª | 1 ä¸ª |
| **Tricycle**ï¼ˆä¸‰è½®æ¨¡å‹ï¼‰ | 1 ä¸ª | 2 ä¸ª |
| **Ackermann**ï¼ˆé˜¿å…‹æ›¼æ¨¡å‹ï¼‰ | 2 ä¸ª | 2 ä¸ª |

---

## æ§åˆ¶å™¨æ¥å£è¯´æ˜

### å‚è€ƒæ¥å£ï¼ˆReferencesï¼Œæ¥è‡ªå‰ç½®æ§åˆ¶å™¨ï¼‰

**ä»…åœ¨é“¾å¼æ¨¡å¼ä¸‹ä½¿ç”¨**ï¼ˆ`in_chained_mode == true`ï¼‰ï¼š

| æ¥å£ | ç±»å‹ | å•ä½ | è¯´æ˜ |
|------|------|------|------|
| `<controller_name>/linear/velocity` | `double` | m/s | æœ¬ä½“çº¿é€Ÿåº¦ |
| `<controller_name>/angular/velocity` | `double` | rad/s | æœ¬ä½“è§’é€Ÿåº¦ |

> è¡¨ç¤ºæœºå™¨äººæœ¬ä½“é€Ÿåº¦ï¼ˆbody twistï¼‰ã€‚

---

### å‘½ä»¤æ¥å£ï¼ˆCommand Interfacesï¼‰

æ ¹æ® `front_steering` å‚æ•°å†³å®šï¼š

#### è‹¥ `front_steering == true`ï¼ˆå‰è½®è½¬å‘ï¼‰
- `<front_wheels_names[i]>/position`ï¼ˆradï¼‰ï¼šå‰è½®è½¬å‘è§’
- `<rear_wheels_names[i]>/velocity`ï¼ˆrad/sï¼‰ï¼šåè½®é©±åŠ¨é€Ÿåº¦

#### è‹¥ `front_steering == false`ï¼ˆåè½®è½¬å‘ï¼‰
- `<front_wheels_names[i]>/velocity`ï¼ˆrad/sï¼‰ï¼šå‰è½®é©±åŠ¨é€Ÿåº¦
- `<rear_wheels_names[i]>/position`ï¼ˆradï¼‰ï¼šåè½®è½¬å‘è§’

---

### çŠ¶æ€æ¥å£ï¼ˆState Interfacesï¼‰

åé¦ˆç±»å‹ç”± `position_feedback` å†³å®šï¼š
- `position_feedback == true` â†’ ç‰µå¼•è½®ä½¿ç”¨ **ä½ç½®åé¦ˆ**ï¼ˆ`position`ï¼‰
- `position_feedback == false` â†’ ç‰µå¼•è½®ä½¿ç”¨ **é€Ÿåº¦åé¦ˆ**ï¼ˆ`velocity`ï¼‰

#### è‹¥ `front_steering == true`
- å‰è½®ï¼š`<front_wheels_names[i]>/position`ï¼ˆradï¼‰
- åè½®ï¼š`<rear_wheels_names[i]>/<TRACTION_FEEDBACK_TYPE>`ï¼ˆrad æˆ– rad/sï¼‰

#### è‹¥ `front_steering == false`
- å‰è½®ï¼š`<front_wheels_names[i]>/<TRACTION_FEEDBACK_TYPE>`ï¼ˆrad æˆ– rad/sï¼‰
- åè½®ï¼š`<rear_wheels_names[i]>/position`ï¼ˆradï¼‰

> **æ³¨**ï¼š`TRACTION_FEEDBACK_TYPE` ç”± `position_feedback` å†³å®šã€‚

---

## ROS 2 æ¥å£

### è®¢é˜…è€…ï¼ˆSubscribersï¼‰

**ä»…åœ¨éé“¾å¼æ¨¡å¼ä¸‹ä½¿ç”¨**ï¼ˆ`in_chained_mode == false`ï¼‰ï¼š

- **`<controller_name>/reference`**ï¼ˆ`geometry_msgs/msg/TwistStamped`ï¼‰  
  å½“ `use_stamped_vel == true` æ—¶ä½¿ç”¨ã€‚
- **`<controller_name>/reference_unstamped`**ï¼ˆ`geometry_msgs/msg/Twist`ï¼‰  
  å½“ `use_stamped_vel == false` æ—¶ä½¿ç”¨ã€‚

---

### å‘å¸ƒè€…ï¼ˆPublishersï¼‰

- **`<controller_name>/odometry`**ï¼ˆ`nav_msgs/msg/Odometry`ï¼‰  
  æœºå™¨äººä½å§¿ä¸é€Ÿåº¦ä¼°è®¡ã€‚
- **`<controller_name>/tf_odometry`**ï¼ˆ`tf2_msgs/msg/TFMessage`ï¼‰  
  é‡Œç¨‹è®¡ TF å˜æ¢ã€‚
- **`<controller_name>/controller_state`**ï¼ˆ`control_msgs/msg/SteeringControllerStatus`ï¼‰  
  æ§åˆ¶å™¨çŠ¶æ€ï¼ˆå¦‚å½“å‰è½¬å‘è§’ã€é€Ÿåº¦ç­‰ï¼‰ã€‚

---

## å‚æ•°ï¼ˆParametersï¼‰

è¯¥åº“ä½¿ç”¨ `generate_parameter_library` ç®¡ç†å‚æ•°ã€‚å®Œæ•´ç¤ºä¾‹è§æ§åˆ¶å™¨åŒ…çš„ `test/` ç›®å½•ã€‚

### æ ¸å¿ƒå‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `reference_timeout` | `double` | `1.0` | å‚è€ƒå‘½ä»¤è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…æ—¶åé‡ç½®ã€‚è®¾ä¸º `0` è¡¨ç¤ºæ¯æ¬¡è¿è¡Œåé‡ç½®ã€‚ |
| `front_steering` | `bool` | `true` | æ˜¯å¦ä¸ºå‰è½®è½¬å‘ï¼Ÿï¼ˆ**åªè¯»**ï¼‰ |

### è½®å­å…³èŠ‚åç§°

| å‚æ•° | é»˜è®¤å€¼ | çº¦æŸ | è¯´æ˜ |
|------|--------|------|------|
| `rear_wheels_names` | â€” | éç©ºã€æ— é‡å¤ã€é•¿åº¦ < 5ï¼ˆ**åªè¯»**ï¼‰ | åè½®å…³èŠ‚å |
| `front_wheels_names` | â€” | éç©ºã€æ— é‡å¤ã€é•¿åº¦ < 5ï¼ˆ**åªè¯»**ï¼‰ | å‰è½®å…³èŠ‚å |
| `rear_wheels_state_names` | `{}` | é•¿åº¦ < 5ï¼Œæ— é‡å¤ï¼ˆ**åªè¯»**ï¼‰ | åè½®çŠ¶æ€è¯»å–å…³èŠ‚åï¼ˆå¯é€‰ï¼‰ |
| `front_wheels_state_names` | `{}` | é•¿åº¦ < 5ï¼Œæ— é‡å¤ï¼ˆ**åªè¯»**ï¼‰ | å‰è½®çŠ¶æ€è¯»å–å…³èŠ‚åï¼ˆå¯é€‰ï¼‰ |

> è‹¥çŠ¶æ€å…³èŠ‚åæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨å‘½ä»¤å…³èŠ‚åã€‚

---

### æ§åˆ¶ä¸é‡Œç¨‹è®¡ç®—

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `open_loop` | `false` | é‡Œç¨‹è®¡æ˜¯å¦ä½¿ç”¨å¼€ç¯è®¡ç®—ï¼ˆåŸºäºå‘½ä»¤è€Œéåé¦ˆï¼‰ |
| `reduce_wheel_speed_until_steering_reached` | `false` | åœ¨è½¬å‘è§’æœªåˆ°ä½å‰é™ä½è½®é€Ÿ |
| `velocity_rolling_window_size` | `10` | è®¡ç®—é‡Œç¨‹è®¡é€Ÿåº¦æ—¶çš„æ»‘åŠ¨çª—å£å¤§å° |
| `position_feedback` | `false` | æ˜¯å¦ä½¿ç”¨ä½ç½®åé¦ˆï¼ˆå¦åˆ™ä½¿ç”¨é€Ÿåº¦åé¦ˆï¼‰ |
| `use_stamped_vel` | `false` | æ˜¯å¦ä½¿ç”¨å¸¦æ—¶é—´æˆ³çš„é€Ÿåº¦æ¶ˆæ¯ |

### åæ ‡ç³»ä¸åæ–¹å·®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `base_frame_id` | `"base_link"` | æœºå™¨äººåŸºåº§åæ ‡ç³» |
| `odom_frame_id` | `"odom"` | é‡Œç¨‹è®¡åæ ‡ç³» |
| `enable_odom_tf` | `true` | æ˜¯å¦å‘å¸ƒ `odom` â†’ `base_link` çš„ TF |
| `twist_covariance_diagonal` | `{0.0, 7.0, 14.0, 21.0, 28.0, 35.0}` | é€Ÿåº¦åæ–¹å·®å¯¹è§’çº¿ï¼ˆ6ç»´ï¼‰ |
| `pose_covariance_diagonal` | `{0.0, 7.0, 14.0, 21.0, 28.0, 35.0}` | ä½å§¿åæ–¹å·®å¯¹è§’çº¿ï¼ˆ6ç»´ï¼‰ |

---